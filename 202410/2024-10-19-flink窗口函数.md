# Flink窗口函数
- URL: https://nightlies.apache.org/flink/flink-docs-release-1.20/zh/docs/dev/table/sql/queries/window-tvf/
- Added At: 2024-10-19 03:07:26
- [Link To Text](2024-10-19-flink窗口函数_raw.md)

## TL;DR
文章介绍了Flink SQL中的窗口表值函数，包括滚动窗口、滑动窗口、累积窗口和会话窗口，它们的特点、使用方式和内置函数。窗口用于将数据划分到不同大小的桶中进行计算，支持聚合、Top-N、Join和去重等操作。文章还讨论了窗口偏移和注意事项，提供了使用示例。

## Summary
1. **窗口表值函数（Windowing TVFs）**
   - 窗口用于将无限流分割为有限大小的桶以进行计算。
   - Flink SQL中的窗口表值函数包括：滚动窗口、滑动窗口、累积窗口和会话窗口。

2. **窗口表值函数特点**
   - 可将表数据划分到不同窗口中。
   - 支持窗口聚合、Top-N、Join和去重等操作。
   - 作为多态表函数，可在SELECT的FROM子句中使用。

3. **内置窗口表值函数**
   - 包括TUMBLE、HOP、CUMULATE和SESSION。
   - 返回值包括原生列和附加的窗口列（window_start、window_end、window_time）。

4. **滚动窗口（TUMBLE）**
   - 将元素分配到固定大小的窗口中。
   - 通过时间属性字段为每行数据分配窗口。
   - 示例：每5分钟生成一个新窗口。

5. **滑动窗口（HOP）**
   - 将元素分配到定长的窗口中，具有滑动步长参数。
   - 可产生数据重叠的效果。
   - 示例：每5分钟滑动一次，窗口大小为10分钟。

6. **累积窗口（CUMULATE）**
   - 从初始窗口开始，直到达到最大窗口大小的所有窗口都包含其区间内的元素。
   - 窗口开始时间固定，可产生重叠且大小不固定的窗口。
   - 示例：1小时步长，24小时大小的累计窗口。

7. **会话窗口（SESSION）**
   - 通过会话活动对元素进行分组。
   - 不重叠，没有固定开始和结束时间。
   - 需要配置会话间隙以定义不活跃间隙的时长。
   - 仅支持流模式，不支持批模式。

8. **窗口偏移**
   - Offset参数可改变窗口分配。
   - 可以是正或负的区间，默认为0。
   - 影响窗口分配，但不会影响Watermark。

9. **示例**
   - 提供了使用Bid表的窗口函数调用示例。
   - 展示了如何应用聚合操作在窗口表上。

10. **注意事项**
    - 会话窗口函数目前不支持批模式和性能调优。
    - 会话窗口Join、Top-N、聚合功能处于实验阶段。
    - 窗口偏移只影响窗口分配，不影响Watermark。
